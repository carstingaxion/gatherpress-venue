(()=>{"use strict";const e=window.React,t=window.wp.blocks,n=window.wp.i18n,r=window.wp.compose,s=window.wp.hooks,o=window.wp.plugins,l=window.wp.element,a=window.wp.data;function i(e=null){return e||(0,a.select)("core/editor").getCurrentPostId()}const c=(0,l.createContext)({postId:0}),u=window.wp.components,p=window.wp.coreData;function d(e=null){return"gatherpress_event"===(e||(0,a.select)("core/editor").getCurrentPostType())}const g="gatherpress_event",m="gatherpress_venue",h="_gatherpress_venue",E="gp-venue-v3",v="core/group",_=(t=null)=>{const[s,o]=(0,l.useState)(""),a=i(t?.context?.postId),[c,d]=(0,p.useEntityProp)("postType",g,h,a),{isResolvingTerms:m,records:E}=(0,p.useEntityRecords)("taxonomy",h,{context:"view",per_page:10,search:s}),v=(0,r.useDebounce)((e=>{o(e)}),300),_=(0,l.useCallback)((e=>{const t=Number.isFinite(e)?[e]:[];d(t)}),[d]);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u.ComboboxControl,{label:(0,n.__)("Choose a venue","gatherpress"),__next40pxDefaultSize:!0,onChange:_,onFilterValueChange:v,options:(()=>{const e=(0,l.useMemo)((()=>E?.map((e=>({label:"TERM "+e?.name,value:e?.id})))||[]),[E]);return m?[{label:(0,n.__)("Loading&hellip;","gatherpress"),value:"loading"}]:e})(),value:c?.[0]||"loading"}))},w=window.wp.blockEditor,y=t=>{const[s,o]=(0,l.useState)(""),{isResolvingPosts:a,records:i}=(0,p.useEntityRecords)("postType",m,{context:"view",per_page:10,search:s}),c=(0,l.useCallback)((e=>{const n={...t.attributes,selectedPostId:e,selectedPostType:m};t.setAttributes(n)}),[t]),d=(0,r.useDebounce)((e=>{o(e)}),300);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u.ComboboxControl,{label:(0,n.__)("Choose a venue","gatherpress"),__next40pxDefaultSize:!0,onChange:c,onFilterValueChange:d,options:(()=>{const e=(0,l.useMemo)((()=>i?.map((e=>({label:"POST "+e?.title.rendered,value:e?.id})))||[]),[i]);return a?[{label:(0,n.__)("Loading&hellip;","gatherpress"),value:"loading"}]:e})(),value:t?.attributes?.selectedPostId||"loading"}))};function b(e){const{venuePost:t}=(0,a.useSelect)((t=>{if(null===e)return[];const n=t("core").getEntityRecord("taxonomy","_gatherpress_venue",e),r=n?.slug.replace(/^_/,"");return{venuePost:t("core").getEntityRecords("postType","gatherpress_venue",{per_page:1,slug:r})}}),[e]);return t}const x=(t=null)=>{const n=d(t?.context?.postType);return(0,e.createElement)(e.Fragment,null,n&&(0,e.createElement)(_,{...t}),!n&&(0,e.createElement)(y,{...t}))},C=(0,r.createHigherOrderComponent)((t=>r=>{if(r.name!==v)return(0,e.createElement)(t,{...r});if(!r?.attributes?.className?.includes(E))return(0,e.createElement)(t,{...r});const s=i(r?.context?.postId),[o,l]=(0,p.useEntityProp)("postType",g,h,s),{isSelected:m}=r,_=Number.isFinite(r?.context?.queryId),y=d(r?.context?.postType),C=function(e){const{termId:t}=(0,a.useSelect)((t=>{const n=t("core").getEntityRecord("postType","gatherpress_event",e);return{termId:n&&n._gatherpress_venue.length>=1?n?._gatherpress_venue?.[0]:null}}),[e]);return b(t)}(s),f=!_&&o instanceof Array,P=b(o&&o.length>=1&&Number.isFinite(o[0])?o[0]:null);let k=f?P:y?C:null,F=k&&k.length>=1&&Number.isFinite(k[0].id)?k[0].id:r?.attributes?.selectedPostId;return(0,e.createElement)(e.Fragment,null,F&&(0,e.createElement)(c.Provider,{value:F},(0,e.createElement)(t,{...r})),!F&&(0,e.createElement)("p",null,(0,e.createElement)("em",null,"What to show, when (1) no venues or (2) an online-event is selected?"),(0,e.createElement)("br",null)," (At least, add a placeholder here to provide help)."),!_&&m&&(0,e.createElement)(w.InspectorControls,null,(0,e.createElement)(u.PanelBody,{title:(0,n.__)("Venue settings","gatherpress"),initialOpen:!0},(0,e.createElement)(u.PanelRow,null,(0,e.createElement)(x,{...r})))))}),"venueEdit"),f={name:E,title:(0,n.__)("Venue Details (v3)","gatherpress"),description:(0,n.__)("Queries information for a venue.","gatherpress"),category:"gatherpress",icon:function(t){const r="string"==typeof t?20:24,s=(0,n.sprintf)("-$%dpx",r/4);return(0,e.createElement)(u.__experimentalZStack,{offset:15,isLayered:!0},(0,e.createElement)((()=>(0,e.createElement)(u.Icon,{icon:t})),null),(0,e.createElement)("div",{style:{color:"var(--wp-components-color-accent,var(--wp-admin-theme-color,#3858e9))",marginTop:s,marginRight:s}},(0,e.createElement)((()=>(0,e.createElement)(u.Icon,{icon:"nametag",size:12})),null)))}("location"),keywords:[(0,n.__)("website","gatherpress"),(0,n.__)("location","gatherpress"),(0,n.__)("city","gatherpress")],scope:["inserter","block"],attributes:{className:E,layout:{type:"flex",orientation:"nonsense"}},isActive:(e,t)=>e?.className.includes(E),innerBlocks:[["core/pattern",{slug:"gatherpress/venue-details"}]]};(0,t.registerBlockVariation)(v,f),(0,s.addFilter)("blocks.registerBlockType","gatherpress-venue/extend-group-block",(function(e,t){return t!==v?e:(-1===e.usesContext.indexOf("queryId")&&e.usesContext.push("queryId"),-1===e.usesContext.indexOf("postId")&&e.usesContext.push("postId"),-1===e.usesContext.indexOf("postType")&&e.usesContext.push("postType"),{...e,attributes:{...e.attributes,selectedPostId:{type:"integer"},selectedPostType:{type:"string"}},supports:{...e.supports,className:!1}})}));const P=(0,r.createHigherOrderComponent)((t=>n=>{const r=(0,l.useContext)(c),s=Number.isFinite(r),o={...n,context:{...n.context,postId:r,postType:m}};return(0,e.createElement)(e.Fragment,null,s&&(0,e.createElement)(t,{...o}),!s&&(0,e.createElement)(t,{...n}))}));(0,s.addFilter)("editor.BlockEdit","gatherpress-venue/child-block-context-provider",P),(0,s.addFilter)("editor.BlockEdit","gatherpress-venue/group-block-variation",C,1),(0,o.registerPlugin)("venue-block-slot-fill",{render:function(){return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u.Fill,{name:"VenuePluginDocumentSettings"},(0,e.createElement)("p",null,'THE "VenueBlockPluginFill" in VenuePluginDocumentSettings')),(0,e.createElement)(u.Fill,{name:"VenuePluginDocumentSettings"},(0,e.createElement)(_,null)))}})})();