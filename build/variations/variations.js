(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.blocks,r=window.wp.i18n,s=window.wp.compose,o=window.wp.hooks,a=window.wp.plugins,l=window.wp.element,i=window.wp.data;function c(e=null){return e||(0,i.select)("core/editor").getCurrentPostId()}const u=(0,l.createContext)({postId:0}),p=window.wp.components,d=window.wp.coreData;function g(e=null){return"gatherpress_event"===(e||(0,i.select)("core/editor").getCurrentPostType())}const m="gatherpress_event",h="gatherpress_venue",v="_gatherpress_venue",_="gp-venue-v3",E="core/group",y=(e=null)=>{const[n,o]=(0,l.useState)(""),a=c(e?.context?.postId),[u,g]=(0,d.useEntityProp)("postType",m,v,a),{isResolvingTerms:h,records:_}=(0,d.useEntityRecords)("taxonomy",v,{context:"view",per_page:10,search:n,orderby:"id",order:"desc"}),E=(0,s.useDebounce)((e=>{o(e)}),300),y=(0,l.useCallback)((e=>{const t=Number.isFinite(e)?[e]:[];g(t)}),[g]),{invalidateResolution:w}=(0,i.useDispatch)("core/data");return(0,l.useEffect)((()=>{u&&w("core","getEntityRecords",["taxonomy",v,{context:"view",per_page:10,search:n,orderby:"id",order:"desc"}])}),[g]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(p.ComboboxControl,{label:(0,r.__)("Choose a venue","gatherpress"),__next40pxDefaultSize:!0,onChange:y,onFilterValueChange:E,options:(()=>{const e=(0,l.useMemo)((()=>_?.map((e=>({label:e?.name,value:e?.id})))||[]),[_]);return h?[{label:(0,r.__)("Loading&hellip;","gatherpress"),value:"loading"}]:e})(),value:u?.[0]||"loading"}))},w=window.wp.blockEditor,x=e=>{const[n,o]=(0,l.useState)(""),{isResolvingPosts:a,records:i}=(0,d.useEntityRecords)("postType",h,{context:"view",per_page:10,search:n}),c=(0,l.useCallback)((t=>{const n={...e.attributes,selectedPostId:t,selectedPostType:h};e.setAttributes(n)}),[e]),u=(0,s.useDebounce)((e=>{o(e)}),300);return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(p.ComboboxControl,{label:(0,r.__)("Choose a venue","gatherpress"),__next40pxDefaultSize:!0,onChange:c,onFilterValueChange:u,options:(()=>{const e=(0,l.useMemo)((()=>i?.map((e=>({label:e?.title.rendered,value:e?.id})))||[]),[i]);return a?[{label:(0,r.__)("Loading&hellip;","gatherpress"),value:"loading"}]:e})(),value:e?.attributes?.selectedPostId||"loading"}))};function b(e){const{venuePost:t}=(0,i.useSelect)((t=>{if(null===e)return[];const n=t("core").getEntityRecord("taxonomy","_gatherpress_venue",e),r=n?.slug.replace(/^_/,"");return{venuePost:t("core").getEntityRecords("postType","gatherpress_venue",{per_page:1,slug:r})}}),[e]);return t}const f=window.wp.apiFetch;var C=e.n(f);function S({title:e,onChangeTitle:n,address:s,onChangeAddress:o,hasEdits:a,lastError:l,isSaving:i,onCancel:c,onSave:u}){return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"gatherpress-new-venue-form"},(0,t.createElement)(p.TextControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,r.__)("Venue title","gatherpress"),value:e,onChange:n}),(0,t.createElement)(p.TextControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,r.__)("Full Address","gatherpress"),value:s,onChange:o})),!!l&&(0,t.createElement)("div",{className:"form-error"},"Error: ",l.message),(0,t.createElement)(p.__experimentalHStack,{justify:"flex-start"},(0,t.createElement)(p.Button,{onClick:u,variant:"primary",disabled:!a||i},i?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(p.Spinner,null),(0,r.__)("Saving","default")):(0,r.__)("Save","default")),(0,t.createElement)(p.Button,{onClick:c,variant:"tertiary",disabled:i},(0,r.__)("Back","default"))))}const T=function(e=null){const[n,r]=(0,t.useState)(),[s,o]=(0,t.useState)(),{lastError:a,isSaving:l}=(0,i.useSelect)((e=>({lastError:e(d.store).getLastEntitySaveError("postType",h),isSaving:e(d.store).isSavingEntityRecord("postType",h)})),[]),u=c(e?.context?.postId),[_,E]=(0,d.useEntityProp)("postType",m,v,u),{goTo:y}=(0,p.__experimentalUseNavigator)(),w=()=>{y("/",{isBack:!0})},{saveEntityRecord:x}=(0,i.useDispatch)(d.store);return(0,t.createElement)(S,{title:null!=n?n:"",onChangeTitle:r,address:null!=s?s:"",onChangeAddress:o,hasEdits:!!n,onSave:async()=>{g()?C()({path:"/wp/v2/gatherpress_venues",method:"POST",data:{title:n,status:"publish",meta:{gatherpress_venue_information:JSON.stringify({fullAddress:s})}}}).then((e=>{console.log(e.title.rendered+" Venue saved successfully."),console.log(e);const t="_"+e.slug;return C()({path:`/wp/v2/_gatherpress_venue?slug=${t}`})})).then((e=>{if(e.length>0){const t=e[0];E([t.id]),console.log("Updates the event with the venue taxonomy term.",t)}})).catch((e=>{console.error("Error creating post or fetching term:",e)})):await(async()=>{const t=await x("postType",h,{title:n,status:"publish",meta:{gatherpress_venue_information:JSON.stringify({fullAddress:s})}});t&&(console.log(t.title.rendered+" Venue saved successfully."),((e,t=null)=>{if(void 0!==t.setAttributes){const n={...t.attributes,selectedPostId:e,selectedPostType:h};t.setAttributes(n)}})(t.id,e))})(),w()},lastError:a,onCancel:w,isSaving:l})};function P(e=null){const n=(0,i.useSelect)((e=>{const{getPostType:t}=e(d.store);return t(h)?.labels?.add_new_item}),[]),r=(0,i.useSelect)((e=>e(d.store).canUser("create",h+"s")),[]);return(0,t.createElement)(p.__experimentalNavigatorProvider,{initialPath:"/",style:{width:"100%"}},(0,t.createElement)(p.__experimentalNavigatorScreen,{path:"/",style:{padding:".1em"}},e.children,r&&(0,t.createElement)(p.__experimentalNavigatorButton,{path:"/new",variant:"tertiary",text:n})),(0,t.createElement)(p.__experimentalNavigatorScreen,{path:"/new",style:{padding:".1em"}},(0,t.createElement)(T,{...e})))}const k=(e=null)=>{const n=g(e?.context?.postType);return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(P,{...e},n&&(0,t.createElement)(y,{...e}),!n&&(0,t.createElement)(x,{...e})))},F=(0,s.createHigherOrderComponent)((e=>n=>{if(n.name!==E)return(0,t.createElement)(e,{...n});if(!n?.attributes?.className?.includes(_))return(0,t.createElement)(e,{...n});const s=c(n?.context?.postId),[o,a]=(0,d.useEntityProp)("postType",m,v,s),{isSelected:l}=n,h=Number.isFinite(n?.context?.queryId),y=g(n?.context?.postType),x=function(e){const{termId:t}=(0,i.useSelect)((t=>{const n=t("core").getEntityRecord("postType","gatherpress_event",e);return{termId:n&&n._gatherpress_venue.length>=1?n?._gatherpress_venue?.[0]:null}}),[e]);return b(t)}(s),f=!h&&o instanceof Array,C=b(o&&o.length>=1&&Number.isFinite(o[0])?o[0]:null);let S=f?C:y?x:null,T=S&&S.length>=1&&Number.isFinite(S[0].id)?S[0].id:n?.attributes?.selectedPostId;return(0,t.createElement)(t.Fragment,null,T&&(0,t.createElement)(u.Provider,{value:T},(0,t.createElement)(e,{...n})),!T&&(0,t.createElement)("p",null,(0,t.createElement)("em",null,"What to show, when (1) no venues or (2) an online-event is selected?"),(0,t.createElement)("br",null)," (At least, add a placeholder here to provide help)."),!h&&l&&(0,t.createElement)(w.InspectorControls,null,(0,t.createElement)(p.PanelBody,{title:(0,r.__)("Venue settings","gatherpress"),initialOpen:!0},(0,t.createElement)(p.PanelRow,null,(0,t.createElement)(k,{...n})))))}),"venueEdit"),I={name:_,title:(0,r.__)("Venue Details (v3)","gatherpress"),description:(0,r.__)("Queries information for a venue.","gatherpress"),category:"gatherpress",icon:function(e){const n="string"==typeof e?20:24,s=(0,r.sprintf)("-$%dpx",n/4);return(0,t.createElement)(p.__experimentalZStack,{offset:15,isLayered:!0},(0,t.createElement)((()=>(0,t.createElement)(p.Icon,{icon:e})),null),(0,t.createElement)("div",{style:{color:"var(--wp-components-color-accent,var(--wp-admin-theme-color,#3858e9))",marginTop:s,marginRight:s}},(0,t.createElement)((()=>(0,t.createElement)(p.Icon,{icon:"nametag",size:12})),null)))}("location"),keywords:[(0,r.__)("website","gatherpress"),(0,r.__)("location","gatherpress"),(0,r.__)("city","gatherpress")],scope:["inserter","block"],attributes:{className:_,layout:{type:"flex",orientation:"nonsense"}},isActive:(e,t)=>e?.className.includes(_),innerBlocks:[["core/pattern",{slug:"gatherpress/venue-details"}]]};(0,n.registerBlockVariation)(E,I),(0,o.addFilter)("blocks.registerBlockType","gatherpress-venue/extend-group-block",(function(e,t){return t!==E?e:(-1===e.usesContext.indexOf("queryId")&&e.usesContext.push("queryId"),-1===e.usesContext.indexOf("postId")&&e.usesContext.push("postId"),-1===e.usesContext.indexOf("postType")&&e.usesContext.push("postType"),{...e,attributes:{...e.attributes,selectedPostId:{type:"integer"},selectedPostType:{type:"string"}},supports:{...e.supports,className:!1}})}));const N=(0,s.createHigherOrderComponent)((e=>n=>{const r=(0,l.useContext)(u),s=Number.isFinite(r),o={...n,context:{...n.context,postId:r,postType:h}};return(0,t.createElement)(t.Fragment,null,s&&(0,t.createElement)(e,{...o}),!s&&(0,t.createElement)(e,{...n}))}));(0,o.addFilter)("editor.BlockEdit","gatherpress-venue/child-block-context-provider",N),(0,o.addFilter)("editor.BlockEdit","gatherpress-venue/group-block-variation",F,1),(0,a.registerPlugin)("venue-block-slot-fill",{render:function(){return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(p.Fill,{name:"EventPluginDocumentSettings"},(0,t.createElement)(k,null)))}})})();